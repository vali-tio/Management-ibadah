<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management Tempat Ibadah</title>
<link rel="manifest" href="manifest.webmanifest">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #4a6da7;
            --secondary-color: #7b9bd4;
            --text-color: #333;
            --bg-color: #f9f9f9;
            --card-bg: #fff;
            --border-color: #ddd;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
        }

        .dark-mode {
            --primary-color: #5c7eb1;
            --secondary-color: #3a4f76;
            --text-color: #f0f0f0;
            --bg-color: #1a1a2e;
            --card-bg: #242439;
            --border-color: #394b6d;
            --success-color: #3cbc8d;
            --danger-color: #e76f7c;
            --warning-color: #e9b949;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 1.8rem;
        }

        .toggle-theme {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.5rem;
        }

        .auth-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pin-input {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .nav {
            background-color: var(--secondary-color);
            overflow-x: auto;
            white-space: nowrap;
        }

        .nav-list {
            display: flex;
            list-style: none;
        }

        .nav-item {
            padding: 0.8rem 1.2rem;
            cursor: pointer;
            color: white;
            border-bottom: 3px solid transparent;
        }

        .nav-item.active {
            border-bottom-color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .content-section {
            padding: 20px 0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--secondary-color);
            color: white;
        }

        tr:hover {
            background-color: rgba(0, 0, 0, 0.03);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        .actions {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .edit-btn {
            background-color: var(--warning-color);
            color: black;
        }

        .delete-btn {
            background-color: var(--danger-color);
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .close {
            font-size: 1.5rem;
            cursor: pointer;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
            color: var(--primary-color);
        }

        .stat-label {
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .nav-item {
                padding: 0.8rem;
                font-size: 0.9rem;
            }

            th, td {
                padding: 8px 10px;
            }

            .stats {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 576px) {
            .logo h1 {
                font-size: 1.5rem;
            }

            .nav-item {
                padding: 0.6rem;
                font-size: 0.8rem;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .auth-section {
                flex-direction: column;
                gap: 5px;
            }

            .pin-input {
                width: 100px;
            }
        }

        /* Responsif tabel jadi kartu di layar kecil */
        @media (max-width: 600px) {
            table, thead, tbody, th, td, tr { display: block; }
            thead { display: none; }
            tr { margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; background: var(--card-bg);}
            td { display: flex; justify-content: space-between; padding: 8px; border: none; }
            td::before { content: attr(data-label); font-weight: bold; }
        }

    </style>
</head>
<footer id="donateFooter">
  <span>Gratis untuk semua</span>
  <a href="https://saweria.co/valitio" target="_blank" rel="noopener noreferrer">
    üíù Dukung via Saweria
  </a>
</footer>

<style>
  #donateFooter {
    position: fixed;
    bottom: 0; left: 0;
    width: 100%;
    background: var(--card);
    border-top: 1px solid var(--border);
    color: var(--text);
    font-size: 0.9rem;
    text-align: center;
    padding: 10px;
    display: flex;
    justify-content: center;
    gap: 10px;
    z-index: 999;
  }
  #donateFooter a {
    color: #f97316;
    font-weight: 600;
    text-decoration: none;
  }
  #donateFooter a:hover {
    text-decoration: underline;
  }
</style>

<body>
    <header>
        <div class="logo">
            <i class="fas fa-place-of-worship" id="logoIcon"></i>
            <h1 id="logoTitle">Management Ibadah</h1>
        </div>
        <div class="auth-section">
            <input type="password" class="pin-input" id="pinInput" placeholder="Masukkan PIN">
            <button class="btn btn-primary" id="loginBtn">Login</button>
            <button class="btn btn-danger" id="logoutBtn" style="display: none;">Logout</button>
            <button class="toggle-theme" id="themeToggle">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </header>

    <div class="nav">
        <ul class="nav-list">
            <li class="nav-item active" data-tab="dashboard">Dashboard</li>
            <li class="nav-item" data-tab="jamaah">Jamaah</li>
            <li class="nav-item" data-tab="worship">Waktu Ibadah</li>
            <li class="nav-item" data-tab="donation">Donasi</li>
            <li class="nav-item" data-tab="inventory">Inventaris</li>
            <li class="nav-item" data-tab="settings">Pengaturan</li>
        </ul>
    </div>

    <div class="container">
        <div class="content-section">
            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboard">
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users fa-2x"></i>
                        </div>
                        <div class="stat-value" id="totalJamaah">0</div>
                        <div class="stat-label">Total Jamaah</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock fa-2x"></i>
                        </div>
                        <div class="stat-value" id="totalWorship">0</div>
                        <div class="stat-label">Jadwal Ibadah</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-donate fa-2x"></i>
                        </div>
                        <div class="stat-value" id="totalDonation">Rp 0</div>
                        <div class="stat-label">Total Donasi</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-boxes fa-2x"></i>
                        </div>
                        <div class="stat-value" id="totalInventory">0</div>
                        <div class="stat-label">Item Inventaris</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Aktivitas Terbaru</h2>
                    </div>
                    <div id="recentActivities">
                        <p>Belum ada aktivitas</p>
                    </div>
                </div>
            </div>

            <!-- Jamaah Tab -->
            <div class="tab-content" id="jamaah">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Data Jamaah</h2>
                        <button class="btn btn-primary" id="addJamaah">Tambah Jamaah</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Nama</th>
                                <th>Telepon</th>
                                <th>Alamat</th>
                                <th>Jenis Kelamin</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="jamaahTable">
                            <!-- Data jamaah akan dimasukkan di sini oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Waktu Ibadah Tab -->
            <div class="tab-content" id="worship">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Jadwal Ibadah</h2>
                        <button class="btn btn-primary" id="addWorship">Tambah Jadwal</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Hari</th>
                                <th>Waktu</th>
                                <th>Jenis Ibadah</th>
                                <th>Tempat</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="worshipTable">
                            <!-- Data jadwal ibadah akan dimasukkan di sini oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Donasi Tab -->
            <div class="tab-content" id="donation">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Data Donasi</h2>
                        <button class="btn btn-primary" id="addDonation">Tambah Donasi</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Nama Donatur</th>
                                <th>Jumlah</th>
                                <th>Jenis Donasi</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="donationTable">
                            <!-- Data donasi akan dimasukkan di sini oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Inventaris Tab -->
            <div class="tab-content" id="inventory">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Inventaris</h2>
                        <button class="btn btn-primary" id="addInventory">Tambah Item</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Nama Barang</th>
                                <th>Jumlah</th>
                                <th>Kondisi</th>
                                <th>Lokasi</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTable">
                            <!-- Data inventaris akan dimasukkan di sini oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pengaturan Tab -->
            <div class="tab-content" id="settings">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Pengaturan Sistem</h2>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ubah PIN</label>
                        <input type="password" class="form-control" id="oldPin" placeholder="PIN Lama">
                        <input type="password" class="form-control" id="newPin" placeholder="PIN Baru" style="margin-top: 10px;">
                        <button class="btn btn-primary" id="changePin" style="margin-top: 10px;">Ubah PIN</button>
                    </div>

                    
<div class="form-group">
    <label class="form-label">Pilih Jenis Tempat Ibadah</label>
    <select class="form-control" id="placeSelect">
        <option value="Ibadah|fa-place-of-worship">Ibadah Umum</option>
        <option value="Masjid|fa-mosque">Masjid</option>
        <option value="Gereja|fa-church">Gereja</option>
        <option value="Pura|fa-om">Pura</option>
        <option value="Vihara|fa-bahai">Vihara</option>
    </select>
    <button class="btn btn-primary" id="savePlace" style="margin-top:10px;">Simpan</button>
</div>

                    <div class="form-group">
                        <label class="form-label">Backup & Restore Data</label>
                        <div class="export-options">
                            <button class="btn btn-success" id="exportJson">Export JSON</button>
                            <button class="btn btn-success" id="exportExcel">Export Excel</button>
                            <button class="btn btn-warning" id="importData">Import Data</button>
                            <button class="btn btn-danger" id="resetData">Reset Data</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal untuk form -->
    <div class="modal" id="formModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Tambah Data</h2>
                <span class="close">&times;</span>
            </div>
            <div id="modalBody">
                <!-- Form akan dimasukkan di sini oleh JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Data aplikasi
        let appData = {
            jamaah: [],
            worship: [],
            donation: [],
            inventory: [],
            settings: {
                pin: "1234" // PIN default
            }
        };

        // Elemen DOM
        const themeToggle = document.getElementById('themeToggle');
        const navItems = document.querySelectorAll('.nav-item');
        const tabContents = document.querySelectorAll('.tab-content');
        const pinInput = document.getElementById('pinInput');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const formModal = document.getElementById('formModal');
        const closeModal = document.querySelector('.close');

        // Inisialisasi aplikasi
        function initApp() {
            // Cek apakah data sudah ada di localStorage
            const savedData = localStorage.getItem('ibadahData');
            if (savedData) {
                appData = JSON.parse(savedData);
            } else {
                // Simpan data default ke localStorage
                saveData();
            }

            // Cek tema yang disimpan
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }

            // Update statistik dashboard
            updateDashboard();

            // Render tabel data
            renderJamaahTable();
            renderWorshipTable();
            renderDonationTable();
            renderInventoryTable();

            // Setup event listeners
            setupEventListeners();
        }

        // Simpan data ke localStorage
        function saveData() {
            localStorage.setItem('ibadahData', JSON.stringify(appData));
        }

        // Update dashboard
        function updateDashboard() {
            document.getElementById('totalJamaah').textContent = appData.jamaah.length;
            document.getElementById('totalWorship').textContent = appData.worship.length;
            
            const totalDonation = appData.donation.reduce((total, item) => total + parseInt(item.amount), 0);
            document.getElementById('totalDonation').textContent = `Rp ${totalDonation.toLocaleString('id-ID')}`;
            
            document.getElementById('totalInventory').textContent = appData.inventory.length;
        }

        // Render tabel jamaah
        function renderJamaahTable() {
            const table = document.getElementById('jamaahTable');
            table.innerHTML = '';
            
            appData.jamaah.forEach((jamaah, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${jamaah.name}</td>
                    <td>${jamaah.phone}</td>
                    <td>${jamaah.address}</td>
                    <td>${jamaah.gender}</td>
                    <td class="actions">
                        <button class="action-btn edit-btn" data-index="${index}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn" data-index="${index}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        // Render tabel waktu ibadah
        function renderWorshipTable() {
            const table = document.getElementById('worshipTable');
            table.innerHTML = '';
            
            appData.worship.forEach((worship, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${worship.day}</td>
                    <td>${worship.time}</td>
                    <td>${worship.type}</td>
                    <td>${worship.place}</td>
                    <td class="actions">
                        <button class="action-btn edit-btn" data-index="${index}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn" data-index="${index}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        // Render tabel donasi
        function renderDonationTable() {
            const table = document.getElementById('donationTable');
            table.innerHTML = '';
            
            appData.donation.forEach((donation, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${donation.date}</td>
                    <td>${donation.donor}</td>
                    <td>Rp ${parseInt(donation.amount).toLocaleString('id-ID')}</td>
                    <td>${donation.type}</td>
                    <td class="actions">
                        <button class="action-btn edit-btn" data-index="${index}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn" data-index="${index}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        // Render tabel inventaris
        function renderInventoryTable() {
            const table = document.getElementById('inventoryTable');
            table.innerHTML = '';
            
            appData.inventory.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.quantity}</td>
                    <td>${item.condition}</td>
                    <td>${item.location}</td>
                    <td class="actions">
                        <button class="action-btn edit-btn" data-index="${index}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn" data-index="${index}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Toggle tema
            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                if (document.body.classList.contains('dark-mode')) {
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                    localStorage.setItem('darkMode', 'true');
                } else {
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                    localStorage.setItem('darkMode', 'false');
                }
            });

            // Navigasi tab
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    const tab = item.getAttribute('data-tab');
                    
                    // Aktifkan tab yang dipilih
                    navItems.forEach(navItem => navItem.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    item.classList.add('active');
                    document.getElementById(tab).classList.add('active');
                });
            });

            // Login
            loginBtn.addEventListener('click', () => {
                if (pinInput.value === appData.settings.pin) {
                    alert('Login berhasil!');
                    pinInput.style.display = 'none';
                    loginBtn.style.display = 'none';
                    logoutBtn.style.display = 'block';
                } else {
                    alert('PIN salah!');
                }
            });

            // Logout
            logoutBtn.addEventListener('click', () => {
                pinInput.style.display = 'inline-block';
                loginBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
                pinInput.value = '';
            });

            // Tutup modal
            closeModal.addEventListener('click', () => {
                formModal.style.display = 'none';
            });

            // Klik di luar modal untuk menutup
            window.addEventListener('click', (e) => {
                if (e.target === formModal) {
                    formModal.style.display = 'none';
                }
            });

            // Tambah jamaah
            document.getElementById('addJamaah').addEventListener('click', () => {
                showJamaahForm();
            });

            // Tambah waktu ibadah
            document.getElementById('addWorship').addEventListener('click', () => {
                showWorshipForm();
            });

            // Tambah donasi
            document.getElementById('addDonation').addEventListener('click', () => {
                showDonationForm();
            });

            // Tambah inventaris
            document.getElementById('addInventory').addEventListener('click', () => {
                showInventoryForm();
            });

            // Ubah PIN
            document.getElementById('changePin').addEventListener('click', () => {
                const oldPin = document.getElementById('oldPin').value;
                const newPin = document.getElementById('newPin').value;
                
                if (oldPin === appData.settings.pin) {
                    appData.settings.pin = newPin;
                    saveData();
                    alert('PIN berhasil diubah!');
                    document.getElementById('oldPin').value = '';
                    document.getElementById('newPin').value = '';
                } else {
                    alert('PIN lama salah!');
                }
            });

            // Export JSON
            document.getElementById('exportJson').addEventListener('click', () => {
                const dataStr = JSON.stringify(appData);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = 'data-ibadah.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            });

            // Export Excel
            document.getElementById('exportExcel').addEventListener('click', () => {
                // Membuat workbook baru
                const wb = XLSX.utils.book_new();
                
                // Menambahkan sheet untuk setiap jenis data
                const jamaahWs = XLSX.utils.json_to_sheet(appData.jamaah);
                XLSX.utils.book_append_sheet(wb, jamaahWs, "Jamaah");
                
                const worshipWs = XLSX.utils.json_to_sheet(appData.worship);
                XLSX.utils.book_append_sheet(wb, worshipWs, "Waktu Ibadah");
                
                const donationWs = XLSX.utils.json_to_sheet(appData.donation);
                XLSX.utils.book_append_sheet(wb, donationWs, "Donasi");
                
                const inventoryWs = XLSX.utils.json_to_sheet(appData.inventory);
                XLSX.utils.book_append_sheet(wb, inventoryWs, "Inventaris");
                
                // Export ke file XLSX
                XLSX.writeFile(wb, "data-ibadah.xlsx");
            });

            // Import data
            document.getElementById('importData').addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = e => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            appData = importedData;
                            saveData();
                            
                            // Update UI
                            updateDashboard();
                            renderJamaahTable();
                            renderWorshipTable();
                            renderDonationTable();
                            renderInventoryTable();
                            
                            alert('Data berhasil diimpor!');
                        } catch (error) {
                            alert('Error mengimpor data: ' + error.message);
                        }
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            });

            // Reset data
            document.getElementById('resetData').addEventListener('click', () => {
                if (confirm('Apakah Anda yakin ingin mereset semua data? Tindakan ini tidak dapat dibatalkan.')) {
                    localStorage.removeItem('ibadahData');
                    appData = {
                        jamaah: [],
                        worship: [],
                        donation: [],
                        inventory: [],
                        settings: {
                            pin: "1234"
                        }
                    };
                    saveData();
                    
                    // Update UI
                    updateDashboard();
                    renderJamaahTable();
                    renderWorshipTable();
                    renderDonationTable();
                    renderInventoryTable();
                    
                    alert('Data berhasil direset!');
                }
            });

            // Event delegation untuk edit dan hapus
            document.addEventListener('click', (e) => {
                // Edit jamaah
                if (e.target.closest('#jamaahTable .edit-btn')) {
                    const index = e.target.closest('.edit-btn').getAttribute('data-index');
                    showJamaahForm(index);
                }
                
                // Hapus jamaah
                if (e.target.closest('#jamaahTable .delete-btn')) {
                    const index = e.target.closest('.delete-btn').getAttribute('data-index');
                    if (confirm('Apakah Anda yakin ingin menghapus jamaah ini?')) {
                        appData.jamaah.splice(index, 1);
                        saveData();
                        renderJamaahTable();
                        updateDashboard();
                    }
                }
                
                // Edit waktu ibadah
                if (e.target.closest('#worshipTable .edit-btn')) {
                    const index = e.target.closest('.edit-btn').getAttribute('data-index');
                    showWorshipForm(index);
                }
                
                // Hapus waktu ibadah
                if (e.target.closest('#worshipTable .delete-btn')) {
                    const index = e.target.closest('.delete-btn').getAttribute('data-index');
                    if (confirm('Apakah Anda yakin ingin menghapus jadwal ibadah ini?')) {
                        appData.worship.splice(index, 1);
                        saveData();
                        renderWorshipTable();
                        updateDashboard();
                    }
                }
                
                // Edit donasi
                if (e.target.closest('#donationTable .edit-btn')) {
                    const index = e.target.closest('.edit-btn').getAttribute('data-index');
                    showDonationForm(index);
                }
                
                // Hapus donasi
                if (e.target.closest('#donationTable .delete-btn')) {
                    const index = e.target.closest('.delete-btn').getAttribute('data-index');
                    if (confirm('Apakah Anda yakin ingin menghapus donasi ini?')) {
                        appData.donation.splice(index, 1);
                        saveData();
                        renderDonationTable();
                        updateDashboard();
                    }
                }
                
                // Edit inventaris
                if (e.target.closest('#inventoryTable .edit-btn')) {
                    const index = e.target.closest('.edit-btn').getAttribute('data-index');
                    showInventoryForm(index);
                }
                
                // Hapus inventaris
                if (e.target.closest('#inventoryTable .delete-btn')) {
                    const index = e.target.closest('.delete-btn').getAttribute('data-index');
                    if (confirm('Apakah Anda yakin ingin menghapus item inventaris ini?')) {
                        appData.inventory.splice(index, 1);
                        saveData();
                        renderInventoryTable();
                        updateDashboard();
                    }
                }
            });
        }

        // Tampilkan form jamaah
        function showJamaahForm(index = -1) {
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            if (index === -1) {
                modalTitle.textContent = 'Tambah Jamaah';
            } else {
                modalTitle.textContent = 'Edit Jamaah';
            }
            
            const jamaah = index >= 0 ? appData.jamaah[index] : {
                name: '',
                phone: '',
                address: '',
                gender: 'Laki-laki'
            };
            
            modalBody.innerHTML = `
                <form id="jamaahForm">
                    <div class="form-group">
                        <label class="form-label">Nama</label>
                        <input type="text" class="form-control" name="name" value="${jamaah.name}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Telepon</label>
                        <input type="text" class="form-control" name="phone" value="${jamaah.phone}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Alamat</label>
                        <textarea class="form-control" name="address" rows="3">${jamaah.address}</textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Jenis Kelamin</label>
                        <select class="form-control" name="gender">
                            <option value="Laki-laki" ${jamaah.gender === 'Laki-laki' ? 'selected' : ''}>Laki-laki</option>
                            <option value="Perempuan" ${jamaah.gender === 'Perempuan' ? 'selected' : ''}>Perempuan</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Simpan</button>
                </form>
            `;
            
            formModal.style.display = 'flex';
            
            document.getElementById('jamaahForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const newJamaah = {
                    name: formData.get('name'),
                    phone: formData.get('phone'),
                    address: formData.get('address'),
                    gender: formData.get('gender')
                };
                
                if (index === -1) {
                    appData.jamaah.push(newJamaah);
                } else {
                    appData.jamaah[index] = newJamaah;
                }
                
                saveData();
                renderJamaahTable();
                updateDashboard();
                formModal.style.display = 'none';
            });
        }

        // Tampilkan form waktu ibadah
        function showWorshipForm(index = -1) {
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            if (index === -1) {
                modalTitle.textContent = 'Tambah Jadwal Ibadah';
            } else {
                modalTitle.textContent = 'Edit Jadwal Ibadah';
            }
            
            const worship = index >= 0 ? appData.worship[index] : {
                day: 'Minggu',
                time: '08:00',
                type: '',
                place: 'Masjid'
            };
            
            modalBody.innerHTML = `
                <form id="worshipForm">
                    <div class="form-group">
                        <label class="form-label">Hari</label>
                        <select class="form-control" name="day">
                            <option value="Minggu" ${worship.day === 'Minggu' ? 'selected' : ''}>Minggu</option>
                            <option value="Senin" ${worship.day === 'Senin' ? 'selected' : ''}>Senin</option>
                            <option value="Selasa" ${worship.day === 'Selasa' ? 'selected' : ''}>Selasa</option>
                            <option value="Rabu" ${worship.day === 'Rabu' ? 'selected' : ''}>Rabu</option>
                            <option value="Kamis" ${worship.day === 'Kamis' ? 'selected' : ''}>Kamis</option>
                            <option value="Jumat" ${worship.day === 'Jumat' ? 'selected' : ''}>Jumat</option>
                            <option value="Sabtu" ${worship.day === 'Sabtu' ? 'selected' : ''}>Sabtu</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Waktu</label>
                        <input type="time" class="form-control" name="time" value="${worship.time}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Jenis Ibadah</label>
                        <input type="text" class="form-control" name="type" value="${worship.type}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tempat</label>
                        <input type="text" class="form-control" name="place" value="${worship.place}" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Simpan</button>
                </form>
            `;
            
            formModal.style.display = 'flex';
            
            document.getElementById('worshipForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const newWorship = {
                    day: formData.get('day'),
                    time: formData.get('time'),
                    type: formData.get('type'),
                    place: formData.get('place')
                };
                
                if (index === -1) {
                    appData.worship.push(newWorship);
                } else {
                    appData.worship[index] = newWorship;
                }
                
                saveData();
                renderWorshipTable();
                updateDashboard();
                formModal.style.display = 'none';
            });
        }

        // Tampilkan form donasi
        function showDonationForm(index = -1) {
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            if (index === -1) {
                modalTitle.textContent = 'Tambah Donasi';
            } else {
                modalTitle.textContent = 'Edit Donasi';
            }
            
            const donation = index >= 0 ? appData.donation[index] : {
                date: new Date().toISOString().split('T')[0],
                donor: '',
                amount: '',
                type: 'Uang'
            };
            
            modalBody.innerHTML = `
                <form id="donationForm">
                    <div class="form-group">
                        <label class="form-label">Tanggal</label>
                        <input type="date" class="form-control" name="date" value="${donation.date}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nama Donatur</label>
                        <input type="text" class="form-control" name="donor" value="${donation.donor}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Jumlah</label>
                        <input type="number" class="form-control" name="amount" value="${donation.amount}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Jenis Donasi</label>
                        <select class="form-control" name="type">
                            <option value="Uang" ${donation.type === 'Uang' ? 'selected' : ''}>Uang</option>
                            <option value="Barang" ${donation.type === 'Barang' ? 'selected' : ''}>Barang</option>
                            <option value="Lainnya" ${donation.type === 'Lainnya' ? 'selected' : ''}>Lainnya</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Simpan</button>
                </form>
            `;
            
            formModal.style.display = 'flex';
            
            document.getElementById('donationForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const newDonation = {
                    date: formData.get('date'),
                    donor: formData.get('donor'),
                    amount: formData.get('amount'),
                    type: formData.get('type')
                };
                
                if (index === -1) {
                    appData.donation.push(newDonation);
                } else {
                    appData.donation[index] = newDonation;
                }
                
                saveData();
                renderDonationTable();
                updateDashboard();
                formModal.style.display = 'none';
            });
        }

        // Tampilkan form inventaris
        function showInventoryForm(index = -1) {
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            if (index === -1) {
                modalTitle.textContent = 'Tambah Item Inventaris';
            } else {
                modalTitle.textContent = 'Edit Item Inventaris';
            }
            
            const item = index >= 0 ? appData.inventory[index] : {
                name: '',
                quantity: '1',
                condition: 'Baik',
                location: ''
            };
            
            modalBody.innerHTML = `
                <form id="inventoryForm">
                    <div class="form-group">
                        <label class="form-label">Nama Barang</label>
                        <input type="text" class="form-control" name="name" value="${item.name}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Jumlah</label>
                        <input type="number" class="form-control" name="quantity" value="${item.quantity}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Kondisi</label>
                        <select class="form-control" name="condition">
                            <option value="Baik" ${item.condition === 'Baik' ? 'selected' : ''}>Baik</option>
                            <option value="Rusak Ringan" ${item.condition === 'Rusak Ringan' ? 'selected' : ''}>Rusak Ringan</option>
                            <option value="Rusak Berat" ${item.condition === 'Rusak Berat' ? 'selected' : ''}>Rusak Berat</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Lokasi</label>
                        <input type="text" class="form-control" name="location" value="${item.location}" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Simpan</button>
                </form>
            `;
            
            formModal.style.display = 'flex';
            
            document.getElementById('inventoryForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const newItem = {
                    name: formData.get('name'),
                    quantity: formData.get('quantity'),
                    condition: formData.get('condition'),
                    location: formData.get('location')
                };
                
                if (index === -1) {
                    appData.inventory.push(newItem);
                } else {
                    appData.inventory[index] = newItem;
                }
                
                saveData();
                renderInventoryTable();
                updateDashboard();
                formModal.style.display = 'none';
            });
        }

        
        // --- Logo & Judul sesuai agama ---
        const logoTitle = document.getElementById("logoTitle");
        const logoIcon = document.getElementById("logoIcon");
        const placeSelect = document.getElementById("placeSelect");
        const savePlace = document.getElementById("savePlace");

        document.addEventListener("DOMContentLoaded", () => {
            const saved = localStorage.getItem("placeSetting");
            if (saved) {
                const [title, icon] = saved.split("|");
                logoTitle.textContent = "Management " + title;
                logoIcon.className = "fas " + icon;
                if (placeSelect) placeSelect.value = saved;
            }
        });

        if (savePlace) {
            savePlace.addEventListener("click", () => {
                const val = placeSelect.value;
                const [title, icon] = val.split("|");
                logoTitle.textContent = "Management " + title;
                logoIcon.className = "fas " + icon;
                localStorage.setItem("placeSetting", val);
                alert("Pengaturan berhasil disimpan!");
            });
        }

        // Inisialisasi aplikasi saat halaman dimuat
        document.addEventListener('DOMContentLoaded', initApp);
      if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("Service Worker registered"))
        .catch(err => console.error("SW registration failed:", err));
    }
</script>
</body>
</html>
